{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block content %}

  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Dashboard</h1>
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb breadcrumb-sm mb-0">
      <li class="breadcrumb-item">Project Monitoring System</li>
      <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
      </ol>
    </nav>
</div>

  <div class="alert alert-success" role="alert">
  Welcome to Dashboard! Kindly check table for status updates.
</div>

<table id="poTable" class="hover" style="width:100%">
  <thead>
    <tr>
      <th>Actions</th>
      <th>Purchase Order #</th>
      <th>Date Prepared (Email) </th>
      <th>Date Started</th>
      <th>Target Date</th>
      <th>Completion Date</th>
      <th>Status</th>
      <th></th> <!-- Hidden ID -->
    </tr>
    <tr class="filter-row">
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for po in purchase_orders %}
    <tr>
      <td>
        <button 
            class="btn btn-primary btn-sm"
            onclick="showPurchaseOrderDetails(
              '{{ po.id }}',
              '{{ po.date_recorded }}',
              '{{ po.purchase_order }}',
              '{{ po.customer_branch.customer_name }}',
              '{{ po.customer_branch.branch_name }}',
              '{{ po.date_in_email }}',
              '{{ po.target_date }}',
              '{{ po.item_model }}',
              `{{ po.description|escapejs }}`,
              `{{ po.service_report|escapejs }}`,
              '{{ po.total_days }}',
              '{{ po.manpower_total }}',
              '{{ po.manpower.all|join:", "|escapejs }}',
              '{{ po.time_total }}',
              '{{ po.total_work_hour }}',
              '{{ po.date_started }}',
              '{{ po.completion_date }}',
              '{{ po.completion_code }}',
              '{{ po.delivery_code }}',
              '{{ po.status }}'
            )">
            View
        </button>

      </td>

      <td>{{ po.purchase_order }}</td>
      <td>{{ po.date_recorded }}</td>
      <td>{{ po.date_started }}</td>
      <td>{{ po.target_date }}</td>
      <td>{{ po.completion_date }}</td>
      <td>
          {% if po.status == "Pending" %}
            <button class="btn btn-warning btn-sm status-btn">Pending</button>
          {% elif po.status == "Ongoing" %}
            <button class="btn btn-primary btn-sm status-btn">Ongoing</button>
          {% elif po.status == "Completed" %}
            <button class="btn btn-success btn-sm status-btn">Completed</button>
          {% else %}
            <button class="btn btn-danger btn-sm status-btn">Delayed</button>
          {% endif %}
      </td>
      <td>{{ po.id }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% include 'dashboard_modal.html' %}



<script src="{% static 'js/dashboard.js' %}"></script>


{% endblock %}
